<div class="container mt-20 mb-20">
	<div class="create-game-container">
		<div class="create-game-content">
			<h1>Créer une nouvelle partie</h1>
			<form [formGroup]="gameForm" (ngSubmit)="onSubmit()">
				<div class="game-settings">
					<div class="form-group">
						<label for="name">Nom de la partie :</label>
						<input id="name" type="text" formControlName="name" placeholder="Nom de la partie" />
					</div>

					<div class="form-group">
						<label for="gameType">Type de partie :</label>
						<select id="gameType" formControlName="gameType" (change)="onGameTypeChange()">
							<option [value]="GameType.SOLO_PLAYERS">Joueurs Solo</option>
							<option [value]="GameType.TEAMS">Équipes</option>
						</select>
					</div>
				</div>

				@if (gameForm.get('gameType')?.value === GameType.SOLO_PLAYERS) {
					<div formArrayName="players">
						<h2>Joueurs</h2>
						<div class="players">
						@for (player of getPlayersControls(); track $index) {
							<div [formGroupName]="$index" class="player-group">
								<h3>Joueur {{ $index + 1 }}</h3>
								<div class="form-group">
									<label [for]="'name-' + $index">Pseudo :</label>
									<input [id]="'name-' + $index" type="text" formControlName="name" placeholder="Pseudo" />
								</div>

								<div class="form-group-row">
									<label [for]="'hasPhoto-' + $index">Ajouter une photo ?</label>
									<input [id]="'hasPhoto-' + $index" type="checkbox" formControlName="hasPhoto" />
								</div>

								@if (player.get('hasPhoto')?.value) {
									<div class="form-group">
										<label [for]="'photo-' + $index">URL de l'Image :</label>
										<input [id]="'photo-' + $index" type="url" formControlName="photo" placeholder="https://example.com/image.jpg" />
									</div>
								}

								<button type="button" class="remove-button" (click)="removePlayer($index)" [disabled]="players.length === 1">
									Supprimer ce Joueur
								</button>
							</div>
						}
						</div>
						<button type="button" class="add-button" (click)="addPlayer()">
							Ajouter un Joueur
						</button>
					</div>
				} @else {
					<div formArrayName="teams" class="teams">
						<h2>Équipes</h2>
						@for (team of getTeamsControls(); track $index) {
							<div [formGroupName]="$index" class="team-group">
								<h3>Équipe {{ $index + 1 }}</h3>
								<div class="form-group">
									<label [for]="'team-name-' + $index">Nom de l'équipe :</label>
									<input [id]="'team-name-' + $index" type="text" formControlName="name" placeholder="Nom de l'équipe" />
								</div>

								<div class="form-group">
									<label [for]="'team-color-' + $index">Couleur de l'équipe :</label>
									<input [id]="'team-color-' + $index" type="color" formControlName="color" />
								</div>

								<div formGroupName="coach">
									<h4>Coach</h4>
									<div class="form-group">
										<label [for]="'coach-name-' + $index">Nom du coach :</label>
										<input [id]="'coach-name-' + $index" type="text" formControlName="name" placeholder="Nom du coach" />
									</div>

									<div class="form-group">
										<label [for]="'coach-entity-' + $index">Entité :</label>
										<select [id]="'coach-entity-' + $index" formControlName="entity">
											<option value="">Sélectionner une entité</option>
											@for (entity of entities; track entity) {
												<option [value]="entity">{{ entity }}</option>
											}
										</select>
									</div>

									<div class="form-group">
										<label [for]="'coach-hasPhoto-' + $index">
											<input [id]="'coach-hasPhoto-' + $index" type="checkbox" formControlName="hasPhoto" />
											Ajouter une photo ?
										</label>
									</div>

									@if (team.get('coach.hasPhoto')?.value) {
										<div class="form-group">
											<label [for]="'coach-photo-' + $index">URL de l'Image :</label>
											<input [id]="'coach-photo-' + $index" type="url" formControlName="photo" placeholder="https://example.com/image.jpg" />
										</div>
									}
								</div>

								<div formArrayName="players">
									<h4>Joueurs de l'équipe</h4>
									@for (player of getTeamPlayersControls(team); track $index) {
										<div [formGroupName]="$index" class="player-group">
											<h5>Joueur {{ $index + 1 }}</h5>
											<div class="form-group">
												<label [for]="'player-name-' + $index">Pseudo :</label>
												<input [id]="'player-name-' + $index" type="text" formControlName="name" placeholder="Pseudo" />
											</div>

											<div class="form-group-row">
												<label [for]="'player-hasPhoto-' + $index">Ajouter une photo ?</label>
												<input [id]="'player-hasPhoto-' + $index" type="checkbox" formControlName="hasPhoto" />
											</div>

											@if (player.get('hasPhoto')?.value) {
												<div class="form-group">
													<label [for]="'player-photo-' + $index">URL de l'Image :</label>
													<input [id]="'player-photo-' + $index" type="url" formControlName="photo" placeholder="https://example.com/image.jpg" />
												</div>
											}

											<button type="button" class="remove-button"
													(click)="removePlayer($index, getTeamIndex(team))"
													[disabled]="getTeamPlayersControls(team).length === 1">
												Supprimer ce Joueur
											</button>
											<hr />
										</div>
									}
								</div>

								<div class="button-group">
									<button type="button" class="add-button" (click)="addPlayer()">
										Ajouter un Joueur à l'équipe
									</button>
									<button type="button" class="remove-button" (click)="removeTeam($index)" [disabled]="teams.length === 1">
										Supprimer cette Équipe
									</button>
								</div>
							</div>
						}
						<button type="button" class="add-button" (click)="addTeam()">
							Ajouter une Équipe
						</button>
					</div>
				}
				<hr>
				<div class="button-group">
					<button type="submit" class="submit-button" [disabled]="gameForm.invalid">
						Créer la Partie
					</button>
				</div>
			</form>
		</div>
	</div>
</div>
